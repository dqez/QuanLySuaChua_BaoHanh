@model QuanLySuaChua_BaoHanh.Models.PhieuSuaChua

@{
    ViewData["Title"] = "Cập nhật trạng thái đơn";
    Layout = "~/Areas/TuVanVien/Views/Shared/_LayoutTuVanVien.cshtml";
    string trangThaiHienTai = Model.TrangThai?.ToLower();
}

<div class="container mt-4">
    <h2 class="text-primary">Cập nhật trạng thái đơn</h2>
    <div class="card p-3 mb-4 shadow-sm">
        <p><strong>Mã phiếu:</strong> @Model.PhieuSuaChuaId</p>
        <p><strong>Khách hàng:</strong> @Model.KhachHang?.HoTen</p>
        <p><strong>SĐT:</strong> @Model.KhachHang?.PhoneNumber</p>
        <p><strong>Thiết bị:</strong> @Model.MoTaKhachHang</p>
        <p><strong>Trạng thái hiện tại:</strong> <span class="badge bg-info text-dark">@Model.TrangThai</span></p>
        <div class="d-flex justify-content-between align-items-center">
            <div class="d-flex justify-content-between align-items-center">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <div>
                        <p>
                            <strong>Phương thức thanh toán:</strong>
                            @((Model.PhuongThucThanhToan?.Trim().ToLower() == "tienmat" ||
                                Model.PhuongThucThanhToan?.Trim().ToLower() == "tien mat")
                                ? "Tiền mặt"
                                : Model.PhuongThucThanhToan)

                            <span class="text-danger ms-3">
                                <strong>Tổng tiền:</strong> @(Model.TongTien?.ToString("N0") ?? "0") đ
                            </span>
                        </p>

                        <div class="mt-3 d-flex gap-2">
                            @if ((Model.PhuongThucThanhToan?.ToLower().Contains("tienmat") ?? false)
                            && Model.TrangThai?.ToLower() != "hoan thanh")
                            {
                                <form method="post" asp-action="CapNhatTrangThai" asp-route-id="@Model.PhieuSuaChuaId" class="mb-0">
                                    <input type="hidden" name="trangThaiMoi" value="HoanThanh" />
                                    <button type="submit" class="btn btn-success">
                                        <i class="bi bi-cash-coin"></i> Xác nhận thanh toán
                                    </button>
                                </form>
                            }

                            <a asp-action="CapNhatDon" class="btn btn-secondary">
                                <i class="bi bi-arrow-left"></i> Quay lại danh sách
                            </a>
                        </div>

