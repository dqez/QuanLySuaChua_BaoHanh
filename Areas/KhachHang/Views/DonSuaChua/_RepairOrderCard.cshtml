@using QuanLySuaChua_BaoHanh.Models
@model PhieuSuaChua

<div class="card repair-order-card mb-4">
    <div class="card-body p-0">
        <!-- Phần trạng thái -->
        <div class="status-section">
            <div class="status-header">
                <div class="order-id">
                    <i class="bi bi-file-earmark-text order-icon"></i>
                    #@Model.PhieuSuaChuaId
                </div>

                @{
                    string statusClass = Model.TrangThai switch
                    {
                        nameof(QuanLySuaChua_BaoHanh.Enums.TrangThaiPhieu.ChoXacNhan) => "status-waiting",
                        nameof(QuanLySuaChua_BaoHanh.Enums.TrangThaiPhieu.DaXacNhan) => "status-received",
                        nameof(QuanLySuaChua_BaoHanh.Enums.TrangThaiPhieu.DaPhanCong) => "status-received",
                        nameof(QuanLySuaChua_BaoHanh.Enums.TrangThaiPhieu.ChoKiemTra) => "status-waiting",
                        nameof(QuanLySuaChua_BaoHanh.Enums.TrangThaiPhieu.DangSuaChua) => "status-repairing",
                        nameof(QuanLySuaChua_BaoHanh.Enums.TrangThaiPhieu.DaSuaXong) => "status-received",
                        nameof(QuanLySuaChua_BaoHanh.Enums.TrangThaiPhieu.DaThanhToan) => "status-received",
                        nameof(QuanLySuaChua_BaoHanh.Enums.TrangThaiPhieu.DangVanChuyen) => "status-repairing",
                        nameof(QuanLySuaChua_BaoHanh.Enums.TrangThaiPhieu.HoanThanh) => "status-completed",
                        nameof(QuanLySuaChua_BaoHanh.Enums.TrangThaiPhieu.DaHuy) => "status-cancelled",
                        _ => "status-default"
                    };

                    string statusIcon = Model.TrangThai switch
                    {
                        nameof(QuanLySuaChua_BaoHanh.Enums.TrangThaiPhieu.ChoXacNhan) => "bi-hourglass-split",
                        nameof(QuanLySuaChua_BaoHanh.Enums.TrangThaiPhieu.DaXacNhan) => "bi-check2-circle",
                        nameof(QuanLySuaChua_BaoHanh.Enums.TrangThaiPhieu.DaPhanCong) => "bi-person-check",
                        nameof(QuanLySuaChua_BaoHanh.Enums.TrangThaiPhieu.ChoKiemTra) => "bi-tools",
                        nameof(QuanLySuaChua_BaoHanh.Enums.TrangThaiPhieu.DangSuaChua) => "bi-gear-wide-connected",
                        nameof(QuanLySuaChua_BaoHanh.Enums.TrangThaiPhieu.DaSuaXong) => "bi-check-all",
                        nameof(QuanLySuaChua_BaoHanh.Enums.TrangThaiPhieu.DaThanhToan) => "bi-credit-card",
                        nameof(QuanLySuaChua_BaoHanh.Enums.TrangThaiPhieu.DangVanChuyen) => "bi-truck",
                        nameof(QuanLySuaChua_BaoHanh.Enums.TrangThaiPhieu.HoanThanh) => "bi-trophy",
                        nameof(QuanLySuaChua_BaoHanh.Enums.TrangThaiPhieu.DaHuy) => "bi-x-circle",
                        _ => "bi-question-circle"
                    };
                }

                <span class="status-badge @statusClass">
                    <i class="bi @statusIcon status-icon"></i>
                    @foreach (var prop in typeof(QuanLySuaChua_BaoHanh.Enums.TrangThaiPhieu).GetField(Model.TrangThai).GetCustomAttributes(typeof(System.ComponentModel.DataAnnotations.DisplayAttribute), false))
                    {
                        var displayAttr = (System.ComponentModel.DataAnnotations.DisplayAttribute)prop;
                        @displayAttr.Name
                    }
                </span>
            </div>

            <div class="basic-info">               
                <div class="info-row">
                    <span class="date-created">
                        <i class="bi bi-calendar-check icon"></i>
                        Ngày gửi: @Model.NgayGui.ToString("dd/MM/yyyy")
                    </span>

                    <span class="product-count">
                        <i class="bi bi-box-seam icon"></i>
                        @Model.ChiTietSuaChuas.Count sản phẩm
                    </span>
                    @if (Model.TrangThai == nameof(QuanLySuaChua_BaoHanh.Enums.TrangThaiPhieu.ChoKiemTra) && Model.NgayHen.HasValue)
                    {
                        <span class="appointment-time">
                            <i class="bi bi-clock-history icon text-warning"></i>
                            <span class="text-warning fw-bold">Hẹn kiểm tra: @Model.NgayHen.Value.ToString("dd/MM/yyyy HH:mm")</span>
                        </span>
                    }
                </div>

                <div class="d-flex gap-2">
                    <a href="/KhachHang/DonSuaChua/ChiTiet/@Model.PhieuSuaChuaId" 
                    class="btn btn-details">
                        <i class="bi bi-eye me-1"></i>
                        Chi tiết
                    </a>

                    @if (Model.TrangThai == nameof(QuanLySuaChua_BaoHanh.Enums.TrangThaiPhieu.ChoXacNhan))
                    {
                        <button type="button" 
                        class="btn btn-cancel cancel-order" 
                        data-id="@Model.PhieuSuaChuaId">
                            <i class="bi bi-x-circle me-1"></i>
                            Hủy đơn
                        </button>
                    }                    
                    @if (Model.TrangThai == nameof(QuanLySuaChua_BaoHanh.Enums.TrangThaiPhieu.DaSuaXong) ||
                      Model.TrangThai == nameof(QuanLySuaChua_BaoHanh.Enums.TrangThaiPhieu.DaThanhToan))
                    {
                        if (Model.TrangThai == nameof(QuanLySuaChua_BaoHanh.Enums.TrangThaiPhieu.DaSuaXong))
                        {
                            <a href="/khach-hang/chon-phuong-thuc-thanh-toan/@Model.PhieuSuaChuaId" class="btn btn-payment">
                                <i class="bi bi-credit-card-2-front me-1"></i>
                                Thanh toán
                            </a>
                        }
                        else
                        {
                            <button type="button" class="btn btn-paid" disabled>
                                <i class="bi bi-check-circle me-1"></i>
                                Đã thanh toán
                            </button>
                        }
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .repair-order-card {
        border: none;
        border-radius: 16px;
        box-shadow: 0 4px 15px rgba(0,0,0,0.07);
        transition: all 0.3s ease;
        background-color: #fff;
        overflow: hidden;
        margin-bottom: 1.5rem;
    }

    .repair-order-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 8px 25px rgba(0,0,0,0.1);
    }

    /* Status Section Styles */
    .status-section {
        width: 100%;
        background: linear-gradient(145deg, #f8f9fa 0%, #ffffff 100%);
        padding: 1.5rem;
        border-radius: 16px;
    }

    .status-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1.25rem;
    }

    .order-id {
        font-size: 1.3rem;
        font-weight: 700;
        color: #2c3e50;
        letter-spacing: 0.5px;
        text-shadow: 0px 1px 1px rgba(255,255,255,0.8);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .order-icon {
        color: #3498db;
        width: 20px;
        height: 20px;
    }
    
    .basic-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 1rem;
        margin-top: 1rem;
    }
    
    .info-row {
        display: flex;
        flex-wrap: wrap;
        gap: 1.5rem;
        align-items: center;
    }    .status-badge {
        padding: 0.6rem 1.2rem;
        border-radius: 30px;
        font-size: 0.95rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
        box-shadow: 0 3px 6px rgba(0,0,0,0.08);
    }

    .status-icon {
        font-size: 0.9rem;
    }

    .date-created, .total-price, .product-count {
        font-size: 0.95rem;
        color: #555;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }
    
    .icon {
        color: #3498db;
    }

    /* Status Colors */
    .status-waiting {
        background-color: #fff8e1;
        color: #f57c00;
    }

    .status-received {
        background-color: #e8f4fd;
        color: #0288d1;
    }

    .status-repairing {
        background-color: #e8f5e9;
        color: #388e3c;
    }

    .status-completed {
        background-color: #e3f2fd;
        color: #1565c0;
    }

    .status-cancelled {
        background-color: #fce4ec;
        color: #d81b60;
    }

    .status-default {
        background-color: #f5f5f5;
        color: #424242;
    }
    
    .btn-cancel {
        background-color: #fff1f0;
        border: 1px solid #ffccc7;
        color: #cf1322;
        padding: 0.5rem 1rem;
        border-radius: 8px;
        font-weight: 500;
        transition: all 0.2s ease;
    }

    .btn-cancel:hover {
        background-color: #fff1f0;
        border-color: #ff7875;
    }
    
    .btn-details {
        background-color: #e6f7ff;
        border: 1px solid #91d5ff;
        color: #1890ff;
        padding: 0.5rem 1rem;
        border-radius: 8px;
        font-weight: 500;
        transition: all 0.2s ease;
    }
      .btn-details:hover {
        background-color: #bae7ff;
        border-color: #69c0ff;
    }
    
    .btn-payment {
        background-color: #f6ffed;
        border: 1px solid #b7eb8f;
        color: #52c41a;
        padding: 0.5rem 1rem;
        border-radius: 8px;
        font-weight: 500;
        transition: all 0.2s ease;
        text-decoration: none;
        display: inline-block;
    }
    
    .btn-payment:hover {
        background-color: #d9f7be;
        border-color: #95de64;
        color: #389e0d;
    }
    
    .btn-paid {
        background-color: #f0f5ff;
        border: 1px solid #d6e4ff;
        color: #597ef7;
        padding: 0.5rem 1rem;
        border-radius: 8px;
        font-weight: 500;
        transition: all 0.2s ease;
        cursor: default;
    }
    
    .appointment-time {
        display: block;
        margin-top: 0.75rem;
        padding: 0.5rem 0.75rem;
        background-color: #fff9c4;
        border-radius: 8px;
        border-left: 3px solid #fbc02d;
        font-size: 0.95rem;
    }
    
    .appointment-time .icon {
        color: #f57f17;
    }
</style>
